/*
 * jQuery File Upload Image Preview & Resize Plugin 1.2.2
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2013, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","load-image-meta","load-image-exif","load-image-ios","canvas-to-blob","./jquery.fileupload-process"],e):e(window.jQuery,window.loadImage)}(function(e,t){"use strict";e.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadImageMetaData",always:!0,disableImageHead:"@",disableExif:"@",disableExifThumbnail:"@",disableExifSub:"@",disableExifGps:"@",disabled:"@disableImageMetaDataLoad"},{action:"loadImage",prefix:!0,fileTypes:"@",maxFileSize:"@",noRevoke:"@",disabled:"@disableImageLoad"},{action:"resizeImage",prefix:"image",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",disabled:"@disableImageResize"},{action:"saveImage",disabled:"@disableImageResize"},{action:"saveImageMetaData",disabled:"@disableImageMetaDataSave"},{action:"resizeImage",always:!0,prefix:"preview",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",thumbnail:"@",canvas:"@",disabled:"@disableImagePreview"},{action:"setImage",name:"@imagePreviewName",disabled:"@disableImagePreview"}),e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{loadImageFileTypes:/^image\/(gif|jpeg|png)$/,loadImageMaxFileSize:1e7,imageMaxWidth:1920,imageMaxHeight:1080,imageCrop:!1,disableImageResize:!0,previewMaxWidth:80,previewMaxHeight:80,previewOrientation:!0,previewThumbnail:!0,previewCrop:!1,previewCanvas:!0},processActions:{loadImage:function(n,i){if(i.disabled)return n;var r=this,o=n.files[n.index],a=e.Deferred();return("number"===e.type(i.maxFileSize)&&o.size>i.maxFileSize||i.fileTypes&&!i.fileTypes.test(o.type)||!t(o,function(e){return e.src?(n.img=e,void a.resolveWith(r,[n])):a.rejectWith(r,[n])},i))&&a.rejectWith(r,[n]),a.promise()},resizeImage:function(n,i){if(i.disabled)return n;var r,o,a,s=this,l=e.Deferred(),u=function(e){n[e.getContext?"canvas":"img"]=e,l.resolveWith(s,[n])};return i=e.extend({canvas:!0},i),n.exif&&(i.orientation===!0&&(i.orientation=n.exif.get("Orientation")),i.thumbnail&&(r=n.exif.get("Thumbnail")))?(t(r,u,i),l.promise()):(o=i.canvas&&n.canvas||n.img,o&&(a=t.scale(o,i),a.width!==o.width||a.height!==o.height)?(u(a),l.promise()):n)},saveImage:function(t,n){if(!t.canvas||n.disabled)return t;var i=this,r=t.files[t.index],o=r.name,a=e.Deferred(),s=function(e){e.name||(r.type===e.type?e.name=r.name:r.name&&(e.name=r.name.replace(/\..+$/,"."+e.type.substr(6)))),t.files[t.index]=e,a.resolveWith(i,[t])};if(t.canvas.mozGetAsFile)s(t.canvas.mozGetAsFile(/^image\/(jpeg|png)$/.test(r.type)&&o||(o&&o.replace(/\..+$/,"")||"blob")+".png",r.type));else{if(!t.canvas.toBlob)return t;t.canvas.toBlob(s,r.type)}return a.promise()},loadImageMetaData:function(n,i){if(i.disabled)return n;var r=this,o=e.Deferred();return t.parseMetaData(n.files[n.index],function(t){e.extend(n,t),o.resolveWith(r,[n])},i),o.promise()},saveImageMetaData:function(e,t){if(!(e.imageHead&&e.canvas&&e.canvas.toBlob)||t.disabled)return e;var n=e.files[e.index],i=new Blob([e.imageHead,this._blobSlice.call(n,20)],{type:n.type});return i.name=n.name,e.files[e.index]=i,e},setImage:function(e,t){var n=e.canvas||e.img;return n&&!t.disabled&&(e.files[e.index][t.name||"preview"]=n),e}}})});